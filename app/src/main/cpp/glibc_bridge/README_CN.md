<p align="center">
  <img src="docs/logo.svg" alt="BTA64 Logo" width="200"/>
</p>

<h1 align="center">BTA64: åœ¨ Android ä¸Šè¿è¡Œ Linux ARM64 (glibc) ç¨‹åº</h1>

<p align="center">
  <a href="#-ç®€ä»‹">ç®€ä»‹</a> â€¢
  <a href="#-ç‰¹æ€§">ç‰¹æ€§</a> â€¢
  <a href="#-å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#-api-å‚è€ƒ">API</a> â€¢
  <a href="#%EF%B8%8F-æ„å»º">æ„å»º</a> â€¢
  <a href="#-å·¥ä½œåŸç†">åŸç†</a> â€¢
  <a href="README.md">English</a>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/å¹³å°-Android%20ARM64-green?style=flat-square" alt="Platform"/>
  <img src="https://img.shields.io/badge/è®¸å¯è¯-MIT-blue?style=flat-square" alt="License"/>
  <img src="https://img.shields.io/badge/è¯­è¨€-C11-orange?style=flat-square" alt="Language"/>
  <img src="https://img.shields.io/badge/ç‰ˆæœ¬-1.0.0-red?style=flat-square" alt="Version"/>
</p>

---

BTA64 å¯ä»¥åœ¨ Android è®¾å¤‡ä¸Š**ç›´æ¥è¿è¡Œ**ä½¿ç”¨ glibc ç¼–è¯‘çš„ Linux ARM64 ç¨‹åºï¼Œ**æ— éœ€ä»»ä½• CPU æ¨¡æ‹Ÿ**ã€‚å®ƒä½œä¸º glibc å’Œ bionic ä¹‹é—´çš„å…¼å®¹å±‚ï¼Œç±»ä¼¼äº [Box64](https://github.com/ptitSeb/box64) å¤„ç† x86_64 ç¨‹åºçš„æ–¹å¼ã€‚

> **ä¸ Box64 çš„å…³é”®åŒºåˆ«**: BTA64 ä¸éœ€è¦æ¨¡æ‹Ÿ CPU æŒ‡ä»¤ï¼Œå› ä¸ºå®¿ä¸» (Android) å’Œç›®æ ‡ (Linux) éƒ½ä½¿ç”¨ ARM64 æ¶æ„ã€‚å®ƒåªéœ€è¦æ¡¥æ¥ C åº“çš„å·®å¼‚ï¼

---

## ğŸ“– ç®€ä»‹

BTA64 æ˜¯ä¸€ä¸ª**è¿è¡Œæ—¶åŠ è½½å™¨**å’Œ **glibc-bionic å…¼å®¹å±‚**ï¼Œè®©ä½ æ— éœ€é‡æ–°ç¼–è¯‘å°±èƒ½åœ¨ Android ä¸Šè¿è¡Œ Linux ARM64 å¯æ‰§è¡Œæ–‡ä»¶ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© BTA64ï¼Ÿ

| ä¼˜åŠ¿ | æè¿° |
|------|------|
| ğŸš€ **åŸç”Ÿé€Ÿåº¦** | æ—  CPU æ¨¡æ‹Ÿï¼Œç›´æ¥æ‰§è¡Œ ARM64 æŒ‡ä»¤ |
| ğŸ“¦ **è‡ªåŒ…å«** | ä¸éœ€è¦çœŸå®çš„ glibc åº“æ–‡ä»¶ |
| ğŸ”„ **é€æ˜æ‰§è¡Œ** | ç¨‹åºå¦‚åŒåœ¨ Linux ç³»ç»Ÿä¸Šè¿è¡Œ |
| ğŸ“± **Android é›†æˆ** | é€šè¿‡ JNI è½»æ¾é›†æˆåˆ° Android åº”ç”¨ |

---

## âœ¨ ç‰¹æ€§

### æ ¸å¿ƒèƒ½åŠ›

- **ELF åŠ è½½**: å®Œæ•´æ”¯æŒ PIE å’ŒåŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶
- **åŠ¨æ€é“¾æ¥**: è‡ªå®šä¹‰é“¾æ¥å™¨ï¼Œæ”¯æŒ 350+ ç¬¦å·æ˜ å°„
- **è¾“å‡ºæ•è·**: æ•è·ç¨‹åºçš„ stdout/stderr è¾“å‡º
- **è¿›ç¨‹éš”ç¦»**: åœ¨ç‹¬ç«‹å­è¿›ç¨‹ä¸­å®‰å…¨æ‰§è¡Œ

### ç¬¦å·å…¼å®¹æ€§

| ç±»åˆ« | glibc å‡½æ•° | çŠ¶æ€ |
|------|-----------|------|
| **ctype** | `__ctype_b_loc()`, `__ctype_tolower_loc()` | âœ… åŒ…è£…å™¨ |
| **errno** | `__errno_location()` | âœ… åŒ…è£…å™¨ |
| **stdio** | `fopen`, `fread`, `fprintf` ç­‰ | âœ… FILE è½¬æ¢ |
| **stat** | `__xstat64()`, `__fxstat64()` | âœ… æ˜ å°„åˆ° bionic |
| **locale** | `newlocale()`, `*_l()` å‡½æ•° | âœ… æ¡©å®ç° |
| **fortify** | `__sprintf_chk()`, `__fprintf_chk()` | âœ… åŒ…è£…å™¨ |
| **gettext** | `gettext()`, `ngettext()` | âœ… é€ä¼  |
| **C++** | `std::ios_base::Init`, å¼‚å¸¸ | âœ… åŒ…è£…å™¨ |
| **å¯åŠ¨** | `__libc_start_main()` | âœ… è‡ªå®šä¹‰å®ç° |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### C API ä½¿ç”¨

```c
#include "bta64_api.h"

int main() {
    // åˆå§‹åŒ–è¿è¡Œæ—¶
    bta64_t bta = bta64_init(NULL);
    
    // æ‰§è¡Œ Linux ARM64 ç¨‹åº
    char* args[] = {"hello", "world", NULL};
    bta64_result_t result;
    
    int ret = bta64_exec(bta, "/path/to/linux_program", 2, args, NULL, &result);
    
    if (result.exited) {
        printf("é€€å‡ºç : %d\n", result.exit_code);
    }
    
    // æ¸…ç†
    bta64_result_free(&result);
    bta64_cleanup(bta);
    
    return ret;
}
```

### ç®€å•ä¸€æ¬¡æ€§æ‰§è¡Œ

```c
// ç”¨æœ€å°‘ä»£ç è¿è¡Œç¨‹åº
int exit_code = bta64_simple_exec("/path/to/program", argc, argv);
```

### Android JNI é›†æˆ

```java
public class BTA64 {
    static { System.loadLibrary("bta64"); }
    
    public native int exec(String path, String[] args);
}
```

---

## ğŸ“š API å‚è€ƒ

### åˆå§‹åŒ–

```c
// ä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–
bta64_t bta64_init(const bta64_config_t* config);

// æ¸…ç†å¹¶é‡Šæ”¾èµ„æº
void bta64_cleanup(bta64_t bta);
```

### é…ç½®

```c
typedef struct {
    bta64_log_level_t log_level;    // BTA64_LOG_NONE åˆ° BTA64_LOG_DEBUG
    size_t stack_size;               // é»˜è®¤: 8MB
    int redirect_output;             // æ•è· stdout/stderr
    int use_tls;                     // è®¾ç½® glibc å…¼å®¹çš„ TLS
    const char* lib_path;            // åº“æœç´¢è·¯å¾„
} bta64_config_t;
```

### ELF åŠ è½½

```c
// åŠ è½½ ELF æ–‡ä»¶
bta64_elf_t bta64_load(bta64_t bta, const char* path);

// è·å– ELF ä¿¡æ¯
bta64_error_t bta64_elf_info(bta64_elf_t elf, bta64_elf_info_t* info);

// å¸è½½ ELF
void bta64_unload(bta64_elf_t elf);
```

### æ‰§è¡Œ

```c
// è¿è¡Œå·²åŠ è½½çš„ ELF
int bta64_run(bta64_t bta, bta64_elf_t elf, 
              int argc, char** argv, char** envp,
              bta64_result_t* result);

// åŠ è½½å¹¶è¿è¡Œï¼ˆä¸€æ­¥å®Œæˆï¼‰
int bta64_exec(bta64_t bta, const char* path,
               int argc, char** argv, char** envp,
               bta64_result_t* result);
```

### æ‰§è¡Œç»“æœ

```c
typedef struct {
    int exit_code;      // é€€å‡ºç ï¼ˆæ­£å¸¸é€€å‡ºæ—¶ï¼‰
    int signal;         // ä¿¡å·ç¼–å·ï¼ˆè¢«ä¿¡å·æ€æ­»æ—¶ï¼‰
    int exited;         // 1 = æ­£å¸¸é€€å‡º, 0 = ä¿¡å·ç»ˆæ­¢
    char* stdout_buf;   // æ•è·çš„ stdout
    size_t stdout_len;
    char* stderr_buf;   // æ•è·çš„ stderr
    size_t stderr_len;
} bta64_result_t;
```

### ç¯å¢ƒå˜é‡

| å˜é‡ | æè¿° | å–å€¼ |
|------|------|------|
| `BTA64_LOG_LEVEL` | æ—¥å¿—è¯¦ç»†ç¨‹åº¦ | `0`-`5` (0=æ— , 3=ä¿¡æ¯, 5=è·Ÿè¸ª) |
| `BTA64_LIB_PATH` | åº“æœç´¢è·¯å¾„ | ç›®å½•è·¯å¾„ |

---

## ğŸ› ï¸ æ„å»º

### å‰ç½®è¦æ±‚

- **Android**: Android NDK r21+ (API 29+)
- **Linux**: æ”¯æŒ ARM64 çš„ GCC/Clang
- **æ ‡å‡†**: C11

### Android NDK æ„å»º

```bash
export ANDROID_NDK=/path/to/android-ndk
export ANDROID_API=29
make android
```

### CMake æ„å»º

```bash
mkdir build && cd build
cmake .. -DANDROID=ON
make -j$(nproc)
```

### æ ‡å‡†æ„å»º

```bash
make
# æˆ–å¸¦è°ƒè¯•ç¬¦å·
make DEBUG=1
```

### æ„å»ºäº§ç‰©

| è¾“å‡º | æè¿° |
|------|------|
| `libbta64.so` | å…±äº«åº“ |
| `libbta64.a` | é™æ€åº“ |

---

## ğŸ”§ å·¥ä½œåŸç†

### æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Linux ARM64 ç¨‹åº                          â”‚
â”‚               (ä½¿ç”¨ glibc ç¼–è¯‘ï¼Œå¦‚ GCC)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BTA64 è¿è¡Œæ—¶                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ELF åŠ è½½å™¨  â”‚  â”‚   é‡å®šä½å™¨  â”‚  â”‚     ç¬¦å·è§£æå™¨      â”‚  â”‚
â”‚  â”‚ (bta64_     â”‚  â”‚ (bta64_     â”‚  â”‚  (bta64_resolver.c) â”‚  â”‚
â”‚  â”‚  loader.c)  â”‚  â”‚  reloc.c)   â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç¬¦å·è·¯ç”±                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      åŒ…è£…å‡½æ•°         â”‚  â”‚      ç›´æ¥é€ä¼              â”‚   â”‚
â”‚  â”‚  (__ctype_b_loc,      â”‚  â”‚  (malloc, printf,         â”‚   â”‚
â”‚  â”‚   __libc_start_main)  â”‚  â”‚   pthread_create)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Android Bionic libc                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰§è¡Œæµç¨‹

1. **åŠ è½½ ELF**: è§£æ ELF å¤´ï¼Œå°†æ®µæ˜ å°„åˆ°å†…å­˜
2. **è®¾ç½® TLS**: åˆå§‹åŒ– glibc å…¼å®¹çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨
3. **Fork è¿›ç¨‹**: åœ¨éš”ç¦»çš„å­è¿›ç¨‹ä¸­æ‰§è¡Œ
4. **é‡å®šä½**: ä½¿ç”¨è‡ªå®šä¹‰ç¬¦å·è§£æå™¨åº”ç”¨é‡å®šä½
5. **ç¬¦å·æ˜ å°„**: å°† glibc ç¬¦å·è·¯ç”±åˆ°åŒ…è£…å™¨æˆ– bionic
6. **æ‰§è¡Œ**: è·³è½¬åˆ° `_start` â†’ `__libc_start_main` â†’ `main()`
7. **æ•è·è¾“å‡º**: é€šè¿‡ç®¡é“æ”¶é›† stdout/stderr

### æ¨¡å—ç»“æ„

```
bta64/src/
â”œâ”€â”€ bta64_core.c          # è¿è¡Œæ—¶åˆå§‹åŒ–ï¼Œä¸» API
â”œâ”€â”€ bta64_loader.c        # ELF è§£æå’Œå†…å­˜åŠ è½½
â”œâ”€â”€ bta64_runner.c        # Fork æ‰§è¡Œï¼ŒTLS è®¾ç½®
â”œâ”€â”€ bta64_dynlink.c       # åŠ¨æ€é“¾æ¥å™¨å…¥å£
â”œâ”€â”€ bta64_stdio.c         # FILE* ç»“æ„è½¬æ¢
â”œâ”€â”€ bta64_tls.c           # çº¿ç¨‹æœ¬åœ°å­˜å‚¨å…¼å®¹
â”œâ”€â”€ bta64_sharedlib.c     # å…±äº«åº“åŠ è½½
â”‚
â”œâ”€â”€ dynlink/              # åŠ¨æ€é“¾æ¥å­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ bta64_log.c       # ç¯å¢ƒå˜é‡æ§åˆ¶çš„æ—¥å¿—
â”‚   â”œâ”€â”€ bta64_symbol_table.c  # 350+ ç¬¦å·æ˜ å°„
â”‚   â”œâ”€â”€ bta64_resolver.c  # ç¬¦å·æŸ¥æ‰¾é€»è¾‘
â”‚   â””â”€â”€ bta64_reloc.c     # AArch64 é‡å®šä½å¤„ç†
â”‚
â””â”€â”€ wrappers/             # glibc å‡½æ•°åŒ…è£…å™¨
    â”œâ”€â”€ wrapper_libc.c    # __libc_start_main, error() ç­‰
    â”œâ”€â”€ wrapper_stat.c    # __xstat64 â†’ stat
    â”œâ”€â”€ wrapper_locale.c  # Locale _l() å‡½æ•°
    â”œâ”€â”€ wrapper_fortify.c # FORTIFY _chk() å‡½æ•°
    â”œâ”€â”€ wrapper_gettext.c # å›½é™…åŒ–æ¡©
    â””â”€â”€ wrapper_cxx.c     # C++ è¿è¡Œæ—¶å…¼å®¹
```

---

## ğŸ“‹ é™åˆ¶

| é™åˆ¶ | æè¿° |
|------|------|
| **FILE ç»“æ„** | ç›´æ¥è®¿é—® FILE å†…éƒ¨å¯èƒ½å¤±è´¥ |
| **é«˜çº§ TLS** | æŸäº› TLS æ¨¡å¼ä¸æ”¯æŒ |
| **ç³»ç»Ÿè°ƒç”¨** | Linux ä¸“æœ‰ç³»ç»Ÿè°ƒç”¨åœ¨ Android ä¸Šä¸å¯ç”¨ |
| **å¤æ‚åº“** | å¯èƒ½éœ€è¦é¢å¤–çš„åŒ…è£…å™¨ |

---

## ğŸ™ è‡´è°¢

BTA64 çš„çµæ„Ÿæ¥æºäºä»¥ä¸‹ä¼˜ç§€é¡¹ç›®ï¼š

| é¡¹ç›® | å€Ÿé‰´å†…å®¹ |
|------|----------|
| [Box64](https://github.com/ptitSeb/box64) | åŒ…è£…åº“æœºåˆ¶ |
| [libhybris](https://github.com/libhybris/libhybris) | glibc/bionic æ¡¥æ¥ |
| [gcompat](https://git.adelielinux.org/AdelieLinux/gcompat) | å…¼å®¹å±‚è®¾è®¡ |

ç‰¹åˆ«æ„Ÿè°¢ **ptitSeb** å¼€å‘çš„å‡ºè‰²çš„ Box64 é¡¹ç›®ï¼

---

## ğŸ“„ è®¸å¯è¯

MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

<p align="center">
  <b>â­ å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œè¯·ç»™ä¸ª Starï¼</b>
</p>
